module.exports=[88824,(a,b,c)=>{a.e,function(a){"use strict";class b{constructor(a,b){this.state={angle:0,area:[],position:{x:0,y:0},hardAngle:0,hardDrawingAngle:0},this.createdDensity=b,this.nowDrawingDensity=this.createdDensity,this.render=a}setDensity(a){this.createdDensity=a,this.nowDrawingDensity=a}setDrawingDensity(a){this.nowDrawingDensity=a}setPosition(a){this.state.position=a}setAngle(a){this.state.angle=a}setArea(a){this.state.area=a}setHardDrawingAngle(a){this.state.hardDrawingAngle=a}setHardAngle(a){this.state.hardAngle=a,this.state.hardDrawingAngle=a}setOrientation(a){this.orientation=a}getDrawingDensity(){return this.nowDrawingDensity}getDensity(){return this.createdDensity}getHardAngle(){return this.state.hardAngle}}class c extends b{constructor(a,b,c){super(a,c),this.image=null,this.isLoad=!1,this.loadingAngle=0,this.image=new Image,this.image.src=b}draw(a){let b=this.render.getContext(),c=this.render.convertToGlobal(this.state.position),d=this.render.getRect().pageWidth,e=this.render.getRect().height;for(let a of(b.save(),b.translate(c.x,c.y),b.beginPath(),this.state.area))null!==a&&(a=this.render.convertToGlobal(a),b.lineTo(a.x-c.x,a.y-c.y));b.rotate(this.state.angle),b.clip(),this.isLoad?b.drawImage(this.image,0,0,d,e):this.drawLoader(b,{x:0,y:0},d,e),b.restore()}simpleDraw(a){let b=this.render.getRect(),c=this.render.getContext(),d=b.pageWidth,e=b.height,f=1===a?b.left+b.pageWidth:b.left,g=b.top;this.isLoad?c.drawImage(this.image,f,g,d,e):this.drawLoader(c,{x:f,y:g},d,e)}drawLoader(a,b,c,d){a.beginPath(),a.strokeStyle="rgb(200, 200, 200)",a.fillStyle="rgb(255, 255, 255)",a.lineWidth=1,a.rect(b.x+1,b.y+1,c-1,d-1),a.stroke(),a.fill();let e={x:b.x+c/2,y:b.y+d/2};a.beginPath(),a.lineWidth=10,a.arc(e.x,e.y,20,this.loadingAngle,3*Math.PI/2+this.loadingAngle),a.stroke(),a.closePath(),this.loadingAngle+=.07,this.loadingAngle>=2*Math.PI&&(this.loadingAngle=0)}load(){this.isLoad||(this.image.onload=()=>{this.isLoad=!0})}newTemporaryCopy(){return this}getTemporaryCopy(){return this}hideTemporaryCopy(){}}class d{constructor(a,b){this.pages=[],this.currentPageIndex=0,this.currentSpreadIndex=0,this.landscapeSpread=[],this.portraitSpread=[],this.render=b,this.app=a,this.currentPageIndex=0,this.isShowCover=this.app.getSettings().showCover}destroy(){this.pages=[]}createSpread(){this.landscapeSpread=[],this.portraitSpread=[];for(let a=0;a<this.pages.length;a++)this.portraitSpread.push([a]);let a=0;this.isShowCover&&(this.pages[0].setDensity("hard"),this.landscapeSpread.push([a]),a++);for(let b=a;b<this.pages.length;b+=2)b<this.pages.length-1?this.landscapeSpread.push([b,b+1]):(this.landscapeSpread.push([b]),this.pages[b].setDensity("hard"))}getSpread(){return"landscape"===this.render.getOrientation()?this.landscapeSpread:this.portraitSpread}getSpreadIndexByPage(a){let b=this.getSpread();for(let c=0;c<b.length;c++)if(a===b[c][0]||a===b[c][1])return c;return null}getPageCount(){return this.pages.length}getPages(){return this.pages}getPage(a){if(a>=0&&a<this.pages.length)return this.pages[a];throw Error("Invalid page number")}nextBy(a){let b=this.pages.indexOf(a);return b<this.pages.length-1?this.pages[b+1]:null}prevBy(a){let b=this.pages.indexOf(a);return b>0?this.pages[b-1]:null}getFlippingPage(a){let b=this.currentSpreadIndex;if("portrait"===this.render.getOrientation())return 0===a?this.pages[b].newTemporaryCopy():this.pages[b-1];{let c=0===a?this.getSpread()[b+1]:this.getSpread()[b-1];return 1===c.length||0===a?this.pages[c[0]]:this.pages[c[1]]}}getBottomPage(a){let b=this.currentSpreadIndex;if("portrait"===this.render.getOrientation())return 0===a?this.pages[b+1]:this.pages[b-1];{let c=0===a?this.getSpread()[b+1]:this.getSpread()[b-1];return 1===c.length?this.pages[c[0]]:0===a?this.pages[c[1]]:this.pages[c[0]]}}showNext(){this.currentSpreadIndex<this.getSpread().length&&(this.currentSpreadIndex++,this.showSpread())}showPrev(){this.currentSpreadIndex>0&&(this.currentSpreadIndex--,this.showSpread())}getCurrentPageIndex(){return this.currentPageIndex}show(a=null){if(null===a&&(a=this.currentPageIndex),a<0||a>=this.pages.length)return;let b=this.getSpreadIndexByPage(a);null!==b&&(this.currentSpreadIndex=b,this.showSpread())}getCurrentSpreadIndex(){return this.currentSpreadIndex}setCurrentSpreadIndex(a){if(!(a>=0&&a<this.getSpread().length))throw Error("Invalid page");this.currentSpreadIndex=a}showSpread(){let a=this.getSpread()[this.currentSpreadIndex];2===a.length?(this.render.setLeftPage(this.pages[a[0]]),this.render.setRightPage(this.pages[a[1]])):"landscape"===this.render.getOrientation()&&a[0]===this.pages.length-1?(this.render.setLeftPage(this.pages[a[0]]),this.render.setRightPage(null)):(this.render.setLeftPage(null),this.render.setRightPage(this.pages[a[0]])),this.currentPageIndex=a[0],this.app.updatePageIndex(this.currentPageIndex)}}class e extends d{constructor(a,b,c){super(a,b),this.imagesHref=c}load(){for(let a of this.imagesHref){let b=new c(this.render,a,"soft");b.load(),this.pages.push(b)}this.createSpread()}}class f{static GetDistanceBetweenTwoPoint(a,b){return null===a||null===b?1/0:Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2))}static GetSegmentLength(a){return f.GetDistanceBetweenTwoPoint(a[0],a[1])}static GetAngleBetweenTwoLine(a,b){let c=a[0].y-a[1].y,d=b[0].y-b[1].y,e=a[1].x-a[0].x,f=b[1].x-b[0].x;return Math.acos((c*d+e*f)/(Math.sqrt(c*c+e*e)*Math.sqrt(d*d+f*f)))}static PointInRect(a,b){return null===b?null:b.x>=a.left&&b.x<=a.width+a.left&&b.y>=a.top&&b.y<=a.top+a.height?b:null}static GetRotatedPoint(a,b,c){return{x:a.x*Math.cos(c)+a.y*Math.sin(c)+b.x,y:a.y*Math.cos(c)-a.x*Math.sin(c)+b.y}}static LimitPointToCircle(a,b,c){if(f.GetDistanceBetweenTwoPoint(a,c)<=b)return c;let d=a.x,e=a.y,g=c.x,h=c.y,i=Math.sqrt(Math.pow(b,2)*Math.pow(d-g,2)/(Math.pow(d-g,2)+Math.pow(e-h,2)))+d;c.x<0&&(i*=-1);let j=(i-d)*(e-h)/(d-g)+e;return d-g+e===0&&(j=b),{x:i,y:j}}static GetIntersectBetweenTwoSegment(a,b,c){return f.PointInRect(a,f.GetIntersectBeetwenTwoLine(b,c))}static GetIntersectBeetwenTwoLine(a,b){let c=a[0].y-a[1].y,d=b[0].y-b[1].y,e=a[1].x-a[0].x,f=b[1].x-b[0].x,g=a[0].x*a[1].y-a[1].x*a[0].y,h=b[0].x*b[1].y-b[1].x*b[0].y,i=-(g*f-h*e)/(c*f-d*e),j=-(c*h-d*g)/(c*f-d*e);if(isFinite(i)&&isFinite(j))return{x:i,y:j};if(.1>Math.abs(c*h-d*g-(e*h-f*g)))throw Error("Segment included");return null}static GetCordsFromTwoPoint(a,b){let c=Math.abs(a.x-b.x),d=Math.abs(a.y-b.y),e=Math.max(c,d),f=[a];function g(a,b,c,d,e){return b>a?a+c/d*e:b<a?a-c/d*e:a}for(let h=1;h<=e;h+=1)f.push({x:g(a.x,b.x,c,e,h),y:g(a.y,b.y,d,e,h)});return f}}class g extends b{constructor(a,b,c){super(a,c),this.copiedElement=null,this.temporaryCopy=null,this.isLoad=!1,this.element=b,this.element.classList.add("stf__item"),this.element.classList.add("--"+c)}newTemporaryCopy(){return"hard"===this.nowDrawingDensity?this:(null===this.temporaryCopy&&(this.copiedElement=this.element.cloneNode(!0),this.element.parentElement.appendChild(this.copiedElement),this.temporaryCopy=new g(this.render,this.copiedElement,this.nowDrawingDensity)),this.getTemporaryCopy())}getTemporaryCopy(){return this.temporaryCopy}hideTemporaryCopy(){null!==this.temporaryCopy&&(this.copiedElement.remove(),this.copiedElement=null,this.temporaryCopy=null)}draw(a){let b=a||this.nowDrawingDensity,c=this.render.convertToGlobal(this.state.position),d=this.render.getRect().pageWidth,e=this.render.getRect().height;this.element.classList.remove("--simple");let f=`
            display: block;
            z-index: ${this.element.style.zIndex};
            left: 0;
            top: 0;
            width: ${d}px;
            height: ${e}px;
        `;"hard"===b?this.drawHard(f):this.drawSoft(c,f)}drawHard(a=""){let b=this.render.getRect().left+this.render.getRect().width/2,c=this.state.hardDrawingAngle,d=a+"\n                backface-visibility: hidden;\n                -webkit-backface-visibility: hidden;\n                clip-path: none;\n                -webkit-clip-path: none;\n            "+(0===this.orientation?`transform-origin: ${this.render.getRect().pageWidth}px 0; 
                   transform: translate3d(0, 0, 0) rotateY(${c}deg);`:`transform-origin: 0 0; 
                   transform: translate3d(${b}px, 0, 0) rotateY(${c}deg);`);this.element.style.cssText=d}drawSoft(a,b=""){let c="polygon( ";for(let a of this.state.area)if(null!==a){let b=1===this.render.getDirection()?{x:-a.x+this.state.position.x,y:a.y-this.state.position.y}:{x:a.x-this.state.position.x,y:a.y-this.state.position.y};c+=(b=f.GetRotatedPoint(b,{x:0,y:0},this.state.angle)).x+"px "+b.y+"px, "}c=c.slice(0,-2)+")";let d=b+`transform-origin: 0 0; clip-path: ${c}; -webkit-clip-path: ${c};`+(this.render.isSafari()&&0===this.state.angle?`transform: translate(${a.x}px, ${a.y}px);`:`transform: translate3d(${a.x}px, ${a.y}px, 0) rotate(${this.state.angle}rad);`);this.element.style.cssText=d}simpleDraw(a){let b=this.render.getRect(),c=b.pageWidth,d=b.height,e=1===a?b.left+b.pageWidth:b.left,f=b.top;this.element.classList.add("--simple"),this.element.style.cssText=`
            position: absolute; 
            display: block; 
            height: ${d}px; 
            left: ${e}px; 
            top: ${f}px; 
            width: ${c}px; 
            z-index: ${this.render.getSettings().startZIndex+1};`}getElement(){return this.element}load(){this.isLoad=!0}setOrientation(a){super.setOrientation(a),this.element.classList.remove("--left","--right"),this.element.classList.add(1===a?"--right":"--left")}setDrawingDensity(a){this.element.classList.remove("--soft","--hard"),this.element.classList.add("--"+a),super.setDrawingDensity(a)}}class h extends d{constructor(a,b,c,d){super(a,b),this.element=c,this.pagesElement=d}load(){for(let a of this.pagesElement){let b=new g(this.render,a,"hard"===a.dataset.density?"hard":"soft");b.load(),this.pages.push(b)}this.createSpread()}}class i{constructor(a,b,c,d){this.direction=a,this.corner=b,this.topIntersectPoint=null,this.sideIntersectPoint=null,this.bottomIntersectPoint=null,this.pageWidth=parseInt(c,10),this.pageHeight=parseInt(d,10)}calc(a){try{return this.position=this.calcAngleAndPosition(a),this.calculateIntersectPoint(this.position),!0}catch(a){return!1}}getFlippingClipArea(){let a=[],b=!1;return a.push(this.rect.topLeft),a.push(this.topIntersectPoint),null===this.sideIntersectPoint?b=!0:(a.push(this.sideIntersectPoint),null===this.bottomIntersectPoint&&(b=!1)),a.push(this.bottomIntersectPoint),(b||"bottom"===this.corner)&&a.push(this.rect.bottomLeft),a}getBottomClipArea(){let a=[];return a.push(this.topIntersectPoint),"top"===this.corner?a.push({x:this.pageWidth,y:0}):(null!==this.topIntersectPoint&&a.push({x:this.pageWidth,y:0}),a.push({x:this.pageWidth,y:this.pageHeight})),null!==this.sideIntersectPoint?f.GetDistanceBetweenTwoPoint(this.sideIntersectPoint,this.topIntersectPoint)>=10&&a.push(this.sideIntersectPoint):"top"===this.corner&&a.push({x:this.pageWidth,y:this.pageHeight}),a.push(this.bottomIntersectPoint),a.push(this.topIntersectPoint),a}getAngle(){return 0===this.direction?-this.angle:this.angle}getRect(){return this.rect}getPosition(){return this.position}getActiveCorner(){return 0===this.direction?this.rect.topLeft:this.rect.topRight}getDirection(){return this.direction}getFlippingProgress(){return Math.abs((this.position.x-this.pageWidth)/(2*this.pageWidth)*100)}getCorner(){return this.corner}getBottomPagePosition(){return 1===this.direction?{x:this.pageWidth,y:0}:{x:0,y:0}}getShadowStartPoint(){return"top"===this.corner?this.topIntersectPoint:null!==this.sideIntersectPoint?this.sideIntersectPoint:this.topIntersectPoint}getShadowAngle(){let a=f.GetAngleBetweenTwoLine(this.getSegmentToShadowLine(),[{x:0,y:0},{x:this.pageWidth,y:0}]);return 0===this.direction?a:Math.PI-a}calcAngleAndPosition(a){let b=a;if(this.updateAngleAndGeometry(b),1>Math.abs((b="top"===this.corner?this.checkPositionAtCenterLine(b,{x:0,y:0},{x:0,y:this.pageHeight}):this.checkPositionAtCenterLine(b,{x:0,y:this.pageHeight},{x:0,y:0})).x-this.pageWidth)&&1>Math.abs(b.y))throw Error("Point is too small");return b}updateAngleAndGeometry(a){this.angle=this.calculateAngle(a),this.rect=this.getPageRect(a)}calculateAngle(a){let b=this.pageWidth-a.x+1,c="bottom"===this.corner?this.pageHeight-a.y:a.y,d=2*Math.acos(b/Math.sqrt(c*c+b*b));c<0&&(d=-d);let e=Math.PI-d;if(!isFinite(d)||e>=0&&e<.003)throw Error("The G point is too small");return"bottom"===this.corner&&(d=-d),d}getPageRect(a){return"top"===this.corner?this.getRectFromBasePoint([{x:0,y:0},{x:this.pageWidth,y:0},{x:0,y:this.pageHeight},{x:this.pageWidth,y:this.pageHeight}],a):this.getRectFromBasePoint([{x:0,y:-this.pageHeight},{x:this.pageWidth,y:-this.pageHeight},{x:0,y:0},{x:this.pageWidth,y:0}],a)}getRectFromBasePoint(a,b){return{topLeft:this.getRotatedPoint(a[0],b),topRight:this.getRotatedPoint(a[1],b),bottomLeft:this.getRotatedPoint(a[2],b),bottomRight:this.getRotatedPoint(a[3],b)}}getRotatedPoint(a,b){return{x:a.x*Math.cos(this.angle)+a.y*Math.sin(this.angle)+b.x,y:a.y*Math.cos(this.angle)-a.x*Math.sin(this.angle)+b.y}}calculateIntersectPoint(a){let b={left:-1,top:-1,width:this.pageWidth+2,height:this.pageHeight+2};"top"===this.corner?(this.topIntersectPoint=f.GetIntersectBetweenTwoSegment(b,[a,this.rect.topRight],[{x:0,y:0},{x:this.pageWidth,y:0}]),this.sideIntersectPoint=f.GetIntersectBetweenTwoSegment(b,[a,this.rect.bottomLeft],[{x:this.pageWidth,y:0},{x:this.pageWidth,y:this.pageHeight}])):(this.topIntersectPoint=f.GetIntersectBetweenTwoSegment(b,[this.rect.topLeft,this.rect.topRight],[{x:0,y:0},{x:this.pageWidth,y:0}]),this.sideIntersectPoint=f.GetIntersectBetweenTwoSegment(b,[a,this.rect.topLeft],[{x:this.pageWidth,y:0},{x:this.pageWidth,y:this.pageHeight}])),this.bottomIntersectPoint=f.GetIntersectBetweenTwoSegment(b,[this.rect.bottomLeft,this.rect.bottomRight],[{x:0,y:this.pageHeight},{x:this.pageWidth,y:this.pageHeight}])}checkPositionAtCenterLine(a,b,c){let d=a,e=f.LimitPointToCircle(b,this.pageWidth,d);d!==e&&(d=e,this.updateAngleAndGeometry(d));let g=Math.sqrt(Math.pow(this.pageWidth,2)+Math.pow(this.pageHeight,2)),h=this.rect.bottomRight,i=this.rect.topLeft;if("bottom"===this.corner&&(h=this.rect.topRight,i=this.rect.bottomLeft),h.x<=0){let a=f.LimitPointToCircle(c,g,i);a!==d&&(d=a,this.updateAngleAndGeometry(d))}return d}getSegmentToShadowLine(){let a=this.getShadowStartPoint();return[a,a!==this.sideIntersectPoint&&null!==this.sideIntersectPoint?this.sideIntersectPoint:this.bottomIntersectPoint]}}class j{constructor(a,b){this.flippingPage=null,this.bottomPage=null,this.calc=null,this.state="read",this.render=a,this.app=b}fold(a){this.setState("user_fold"),null===this.calc&&this.start(a),this.do(this.render.convertToPage(a))}flip(a){if(this.app.getSettings().disableFlipByClick&&!this.isPointOnCorners(a)||(null!==this.calc&&this.render.finishAnimation(),!this.start(a)))return;let b=this.getBoundsRect();this.setState("flipping");let c=b.height/10,d="bottom"===this.calc.getCorner()?b.height-c:c,e="bottom"===this.calc.getCorner()?b.height:0;this.calc.calc({x:b.pageWidth-c,y:d}),this.animateFlippingTo({x:b.pageWidth-c,y:d},{x:-b.pageWidth,y:e},!0)}start(a){this.reset();let b=this.render.convertToBook(a),c=this.getBoundsRect(),d=this.getDirectionByPoint(b),e=b.y>=c.height/2?"bottom":"top";if(!this.checkDirection(d))return!1;try{if(this.flippingPage=this.app.getPageCollection().getFlippingPage(d),this.bottomPage=this.app.getPageCollection().getBottomPage(d),"landscape"===this.render.getOrientation())if(1===d){let a=this.app.getPageCollection().nextBy(this.flippingPage);null!==a&&this.flippingPage.getDensity()!==a.getDensity()&&(this.flippingPage.setDrawingDensity("hard"),a.setDrawingDensity("hard"))}else{let a=this.app.getPageCollection().prevBy(this.flippingPage);null!==a&&this.flippingPage.getDensity()!==a.getDensity()&&(this.flippingPage.setDrawingDensity("hard"),a.setDrawingDensity("hard"))}return this.render.setDirection(d),this.calc=new i(d,e,c.pageWidth.toString(10),c.height.toString(10)),!0}catch(a){return!1}}do(a){if(null!==this.calc&&this.calc.calc(a)){let a=this.calc.getFlippingProgress();this.bottomPage.setArea(this.calc.getBottomClipArea()),this.bottomPage.setPosition(this.calc.getBottomPagePosition()),this.bottomPage.setAngle(0),this.bottomPage.setHardAngle(0),this.flippingPage.setArea(this.calc.getFlippingClipArea()),this.flippingPage.setPosition(this.calc.getActiveCorner()),this.flippingPage.setAngle(this.calc.getAngle()),0===this.calc.getDirection()?this.flippingPage.setHardAngle(90*(200-2*a)/100):this.flippingPage.setHardAngle(-90*(200-2*a)/100),this.render.setPageRect(this.calc.getRect()),this.render.setBottomPage(this.bottomPage),this.render.setFlippingPage(this.flippingPage),this.render.setShadowData(this.calc.getShadowStartPoint(),this.calc.getShadowAngle(),a,this.calc.getDirection())}}flipToPage(a,b){let c=this.app.getPageCollection().getCurrentSpreadIndex(),d=this.app.getPageCollection().getSpreadIndexByPage(a);try{d>c&&(this.app.getPageCollection().setCurrentSpreadIndex(d-1),this.flipNext(b)),d<c&&(this.app.getPageCollection().setCurrentSpreadIndex(d+1),this.flipPrev(b))}catch(a){}}flipNext(a){this.flip({x:this.render.getRect().left+2*this.render.getRect().pageWidth-10,y:"top"===a?1:this.render.getRect().height-2})}flipPrev(a){this.flip({x:10,y:"top"===a?1:this.render.getRect().height-2})}stopMove(){if(null===this.calc)return;let a=this.calc.getPosition(),b=this.getBoundsRect(),c="bottom"===this.calc.getCorner()?b.height:0;a.x<=0?this.animateFlippingTo(a,{x:-b.pageWidth,y:c},!0):this.animateFlippingTo(a,{x:b.pageWidth,y:c},!1)}showCorner(a){if(!this.checkState("read","fold_corner"))return;let b=this.getBoundsRect(),c=b.pageWidth;if(this.isPointOnCorners(a))if(null===this.calc){if(!this.start(a))return;this.setState("fold_corner"),this.calc.calc({x:c-1,y:1});let d="bottom"===this.calc.getCorner()?b.height-1:1,e="bottom"===this.calc.getCorner()?b.height-50:50;this.animateFlippingTo({x:c-1,y:d},{x:c-50,y:e},!1,!1)}else this.do(this.render.convertToPage(a));else this.setState("read"),this.render.finishAnimation(),this.stopMove()}animateFlippingTo(a,b,c,d=!0){let e=f.GetCordsFromTwoPoint(a,b),g=[];for(let a of e)g.push(()=>this.do(a));let h=this.getAnimationDuration(e.length);this.render.startAnimation(g,h,()=>{this.calc&&(c&&(1===this.calc.getDirection()?this.app.turnToPrevPage():this.app.turnToNextPage()),d&&(this.render.setBottomPage(null),this.render.setFlippingPage(null),this.render.clearShadow(),this.setState("read"),this.reset()))})}getCalculation(){return this.calc}getState(){return this.state}setState(a){this.state!==a&&(this.app.updateState(a),this.state=a)}getDirectionByPoint(a){let b=this.getBoundsRect();if("portrait"===this.render.getOrientation()){if(a.x-b.pageWidth<=b.width/5)return 1}else if(a.x<b.width/2)return 1;return 0}getAnimationDuration(a){let b=this.app.getSettings().flippingTime;return a>=1e3?b:a/1e3*b}checkDirection(a){return 0===a?this.app.getCurrentPageIndex()<this.app.getPageCount()-1:this.app.getCurrentPageIndex()>=1}reset(){this.calc=null,this.flippingPage=null,this.bottomPage=null}getBoundsRect(){return this.render.getRect()}checkState(...a){for(let b of a)if(this.state===b)return!0;return!1}isPointOnCorners(a){let b=this.getBoundsRect(),c=Math.sqrt(Math.pow(b.pageWidth,2)+Math.pow(b.height,2))/5,d=this.render.convertToBook(a);return d.x>0&&d.y>0&&d.x<b.width&&d.y<b.height&&(d.x<c||d.x>b.width-c)&&(d.y<c||d.y>b.height-c)}}class k{constructor(a,b){this.leftPage=null,this.rightPage=null,this.flippingPage=null,this.bottomPage=null,this.direction=null,this.orientation=null,this.shadow=null,this.animation=null,this.pageRect=null,this.boundsRect=null,this.timer=0,this.safari=!1,this.setting=b,this.app=a;let c=RegExp("Version\\/[\\d\\.]+.*Safari/");this.safari=null!==c.exec(window.navigator.userAgent)}render(a){if(null!==this.animation){let b=Math.round((a-this.animation.startedAt)/this.animation.durationFrame);b<this.animation.frames.length?this.animation.frames[b]():(this.animation.onAnimateEnd(),this.animation=null)}this.timer=a,this.drawFrame()}start(){this.update();let a=b=>{this.render(b),requestAnimationFrame(a)};requestAnimationFrame(a)}startAnimation(a,b,c){this.finishAnimation(),this.animation={frames:a,duration:b,durationFrame:b/a.length,onAnimateEnd:c,startedAt:this.timer}}finishAnimation(){null!==this.animation&&(this.animation.frames[this.animation.frames.length-1](),null!==this.animation.onAnimateEnd&&this.animation.onAnimateEnd()),this.animation=null}update(){this.boundsRect=null;let a=this.calculateBoundsRect();this.orientation!==a&&(this.orientation=a,this.app.updateOrientation(a))}calculateBoundsRect(){let a="landscape",b=this.getBlockWidth(),c=b/2,d=this.getBlockHeight()/2,e=this.setting.width/this.setting.height,f=this.setting.width,g=this.setting.height,h=c-f;return"stretch"===this.setting.size?(b<2*this.setting.minWidth&&this.app.getSettings().usePortrait&&(a="portrait"),(f="portrait"===a?this.getBlockWidth():this.getBlockWidth()/2)>this.setting.maxWidth&&(f=this.setting.maxWidth),(g=f/e)>this.getBlockHeight()&&(f=(g=this.getBlockHeight())*e),h="portrait"===a?c-f/2-f:c-f):b<2*f&&this.app.getSettings().usePortrait&&(a="portrait",h=c-f/2-f),this.boundsRect={left:h,top:d-g/2,width:2*f,height:g,pageWidth:f},a}setShadowData(a,b,c,d){if(!this.app.getSettings().drawShadow)return;let e=100*this.getSettings().maxShadowOpacity;this.shadow={pos:a,angle:b,width:3*this.getRect().pageWidth/4*c/100,opacity:(100-c)*e/100/100,direction:d,progress:2*c}}clearShadow(){this.shadow=null}getBlockWidth(){return this.app.getUI().getDistElement().offsetWidth}getBlockHeight(){return this.app.getUI().getDistElement().offsetHeight}getDirection(){return this.direction}getRect(){return null===this.boundsRect&&this.calculateBoundsRect(),this.boundsRect}getSettings(){return this.app.getSettings()}getOrientation(){return this.orientation}setPageRect(a){this.pageRect=a}setDirection(a){this.direction=a}setRightPage(a){null!==a&&a.setOrientation(1),this.rightPage=a}setLeftPage(a){null!==a&&a.setOrientation(0),this.leftPage=a}setBottomPage(a){null!==a&&a.setOrientation(+(1!==this.direction)),this.bottomPage=a}setFlippingPage(a){null!==a&&a.setOrientation(+(0!==this.direction||"portrait"===this.orientation)),this.flippingPage=a}convertToBook(a){let b=this.getRect();return{x:a.x-b.left,y:a.y-b.top}}isSafari(){return this.safari}convertToPage(a,b){b||(b=this.direction);let c=this.getRect();return{x:0===b?a.x-c.left-c.width/2:c.width/2-a.x+c.left,y:a.y-c.top}}convertToGlobal(a,b){if(b||(b=this.direction),null==a)return null;let c=this.getRect();return{x:0===b?a.x+c.left+c.width/2:c.width/2-a.x+c.left,y:a.y+c.top}}convertRectToGlobal(a,b){return b||(b=this.direction),{topLeft:this.convertToGlobal(a.topLeft,b),topRight:this.convertToGlobal(a.topRight,b),bottomLeft:this.convertToGlobal(a.bottomLeft,b),bottomRight:this.convertToGlobal(a.bottomRight,b)}}}class l extends k{constructor(a,b,c){super(a,b),this.canvas=c,this.ctx=c.getContext("2d")}getContext(){return this.ctx}reload(){}drawFrame(){this.clear(),"portrait"!==this.orientation&&null!=this.leftPage&&this.leftPage.simpleDraw(0),null!=this.rightPage&&this.rightPage.simpleDraw(1),null!=this.bottomPage&&this.bottomPage.draw(),this.drawBookShadow(),null!=this.flippingPage&&this.flippingPage.draw(),null!=this.shadow&&(this.drawOuterShadow(),this.drawInnerShadow());let a=this.getRect();"portrait"===this.orientation&&(this.ctx.beginPath(),this.ctx.rect(a.left+a.pageWidth,a.top,a.width,a.height),this.ctx.clip())}drawBookShadow(){let a=this.getRect();this.ctx.save(),this.ctx.beginPath();let b=a.width/20;this.ctx.rect(a.left,a.top,a.width,a.height);let c={x:a.left+a.width/2-b/2,y:0};this.ctx.translate(c.x,c.y);let d=this.ctx.createLinearGradient(0,0,b,0);d.addColorStop(0,"rgba(0, 0, 0, 0)"),d.addColorStop(.4,"rgba(0, 0, 0, 0.2)"),d.addColorStop(.49,"rgba(0, 0, 0, 0.1)"),d.addColorStop(.5,"rgba(0, 0, 0, 0.5)"),d.addColorStop(.51,"rgba(0, 0, 0, 0.4)"),d.addColorStop(1,"rgba(0, 0, 0, 0)"),this.ctx.clip(),this.ctx.fillStyle=d,this.ctx.fillRect(0,0,b,2*a.height),this.ctx.restore()}drawOuterShadow(){let a=this.getRect();this.ctx.save(),this.ctx.beginPath(),this.ctx.rect(a.left,a.top,a.width,a.height);let b=this.convertToGlobal({x:this.shadow.pos.x,y:this.shadow.pos.y});this.ctx.translate(b.x,b.y),this.ctx.rotate(Math.PI+this.shadow.angle+Math.PI/2);let c=this.ctx.createLinearGradient(0,0,this.shadow.width,0);0===this.shadow.direction?(this.ctx.translate(0,-100),c.addColorStop(0,"rgba(0, 0, 0, "+this.shadow.opacity+")"),c.addColorStop(1,"rgba(0, 0, 0, 0)")):(this.ctx.translate(-this.shadow.width,-100),c.addColorStop(0,"rgba(0, 0, 0, 0)"),c.addColorStop(1,"rgba(0, 0, 0, "+this.shadow.opacity+")")),this.ctx.clip(),this.ctx.fillStyle=c,this.ctx.fillRect(0,0,this.shadow.width,2*a.height),this.ctx.restore()}drawInnerShadow(){let a=this.getRect();this.ctx.save(),this.ctx.beginPath();let b=this.convertToGlobal({x:this.shadow.pos.x,y:this.shadow.pos.y}),c=this.convertRectToGlobal(this.pageRect);this.ctx.moveTo(c.topLeft.x,c.topLeft.y),this.ctx.lineTo(c.topRight.x,c.topRight.y),this.ctx.lineTo(c.bottomRight.x,c.bottomRight.y),this.ctx.lineTo(c.bottomLeft.x,c.bottomLeft.y),this.ctx.translate(b.x,b.y),this.ctx.rotate(Math.PI+this.shadow.angle+Math.PI/2);let d=3*this.shadow.width/4,e=this.ctx.createLinearGradient(0,0,d,0);0===this.shadow.direction?(this.ctx.translate(-d,-100),e.addColorStop(1,"rgba(0, 0, 0, "+this.shadow.opacity+")"),e.addColorStop(.9,"rgba(0, 0, 0, 0.05)"),e.addColorStop(.7,"rgba(0, 0, 0, "+this.shadow.opacity+")"),e.addColorStop(0,"rgba(0, 0, 0, 0)")):(this.ctx.translate(0,-100),e.addColorStop(0,"rgba(0, 0, 0, "+this.shadow.opacity+")"),e.addColorStop(.1,"rgba(0, 0, 0, 0.05)"),e.addColorStop(.3,"rgba(0, 0, 0, "+this.shadow.opacity+")"),e.addColorStop(1,"rgba(0, 0, 0, 0)")),this.ctx.clip(),this.ctx.fillStyle=e,this.ctx.fillRect(0,0,d,2*a.height),this.ctx.restore()}clear(){this.ctx.fillStyle="white",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}}class m{constructor(a,b,c){this.touchPoint=null,this.swipeTimeout=250,this.onResize=()=>{this.update()},this.onMouseDown=a=>{if(this.checkTarget(a.target)){let b=this.getMousePos(a.clientX,a.clientY);this.app.startUserTouch(b),a.preventDefault()}},this.onTouchStart=a=>{if(this.checkTarget(a.target)&&a.changedTouches.length>0){let b=a.changedTouches[0],c=this.getMousePos(b.clientX,b.clientY);this.touchPoint={point:c,time:Date.now()},setTimeout(()=>{null!==this.touchPoint&&this.app.startUserTouch(c)},this.swipeTimeout),this.app.getSettings().mobileScrollSupport||a.preventDefault()}},this.onMouseUp=a=>{let b=this.getMousePos(a.clientX,a.clientY);this.app.userStop(b)},this.onMouseMove=a=>{let b=this.getMousePos(a.clientX,a.clientY);this.app.userMove(b,!1)},this.onTouchMove=a=>{if(a.changedTouches.length>0){let b=a.changedTouches[0],c=this.getMousePos(b.clientX,b.clientY);this.app.getSettings().mobileScrollSupport?(null!==this.touchPoint&&(Math.abs(this.touchPoint.point.x-c.x)>10||"read"!==this.app.getState())&&a.cancelable&&this.app.userMove(c,!0),"read"!==this.app.getState()&&a.preventDefault()):this.app.userMove(c,!0)}},this.onTouchEnd=a=>{if(a.changedTouches.length>0){let b=a.changedTouches[0],c=this.getMousePos(b.clientX,b.clientY),d=!1;if(null!==this.touchPoint){let a=c.x-this.touchPoint.point.x,b=Math.abs(c.y-this.touchPoint.point.y);Math.abs(a)>this.swipeDistance&&b<2*this.swipeDistance&&Date.now()-this.touchPoint.time<this.swipeTimeout&&(a>0?this.app.flipPrev(this.touchPoint.point.y<this.app.getRender().getRect().height/2?"top":"bottom"):this.app.flipNext(this.touchPoint.point.y<this.app.getRender().getRect().height/2?"top":"bottom"),d=!0),this.touchPoint=null}this.app.userStop(c,d)}},this.parentElement=a,a.classList.add("stf__parent"),a.insertAdjacentHTML("afterbegin",'<div class="stf__wrapper"></div>'),this.wrapper=a.querySelector(".stf__wrapper"),this.app=b;let d=this.app.getSettings().usePortrait?1:2;a.style.minWidth=c.minWidth*d+"px",a.style.minHeight=c.minHeight+"px","fixed"===c.size&&(a.style.minWidth=c.width*d+"px",a.style.minHeight=c.height+"px"),c.autoSize&&(a.style.width="100%",a.style.maxWidth=2*c.maxWidth+"px"),a.style.display="block",window.addEventListener("resize",this.onResize,!1),this.swipeDistance=c.swipeDistance}destroy(){this.app.getSettings().useMouseEvents&&this.removeHandlers(),this.distElement.remove(),this.wrapper.remove()}getDistElement(){return this.distElement}getWrapper(){return this.wrapper}setOrientationStyle(a){this.wrapper.classList.remove("--portrait","--landscape"),"portrait"===a?(this.app.getSettings().autoSize&&(this.wrapper.style.paddingBottom=this.app.getSettings().height/this.app.getSettings().width*100+"%"),this.wrapper.classList.add("--portrait")):(this.app.getSettings().autoSize&&(this.wrapper.style.paddingBottom=this.app.getSettings().height/(2*this.app.getSettings().width)*100+"%"),this.wrapper.classList.add("--landscape")),this.update()}removeHandlers(){window.removeEventListener("resize",this.onResize),this.distElement.removeEventListener("mousedown",this.onMouseDown),this.distElement.removeEventListener("touchstart",this.onTouchStart),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("touchend",this.onTouchEnd)}setHandlers(){window.addEventListener("resize",this.onResize,!1),this.app.getSettings().useMouseEvents&&(this.distElement.addEventListener("mousedown",this.onMouseDown),this.distElement.addEventListener("touchstart",this.onTouchStart),window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("touchmove",this.onTouchMove,{passive:!this.app.getSettings().mobileScrollSupport}),window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("touchend",this.onTouchEnd))}getMousePos(a,b){let c=this.distElement.getBoundingClientRect();return{x:a-c.left,y:b-c.top}}checkTarget(a){return!this.app.getSettings().clickEventForward||!["a","button"].includes(a.tagName.toLowerCase())}}class n extends m{constructor(a,b,c,d){for(let e of(super(a,b,c),this.wrapper.insertAdjacentHTML("afterbegin",'<div class="stf__block"></div>'),this.distElement=a.querySelector(".stf__block"),this.items=d,d))this.distElement.appendChild(e);this.setHandlers()}clear(){for(let a of this.items)this.parentElement.appendChild(a)}updateItems(a){for(let b of(this.removeHandlers(),this.distElement.innerHTML="",a))this.distElement.appendChild(b);this.items=a,this.setHandlers()}update(){this.app.getRender().update()}}class o extends m{constructor(a,b,c){super(a,b,c),this.wrapper.innerHTML='<canvas class="stf__canvas"></canvas>',this.canvas=a.querySelectorAll("canvas")[0],this.distElement=this.canvas,this.resizeCanvas(),this.setHandlers()}resizeCanvas(){let a=getComputedStyle(this.canvas),b=parseInt(a.getPropertyValue("width"),10),c=parseInt(a.getPropertyValue("height"),10);this.canvas.width=b,this.canvas.height=c}getCanvas(){return this.canvas}update(){this.resizeCanvas(),this.app.getRender().update()}}class p extends k{constructor(a,b,c){super(a,b),this.outerShadow=null,this.innerShadow=null,this.hardShadow=null,this.hardInnerShadow=null,this.element=c,this.createShadows()}createShadows(){this.element.insertAdjacentHTML("beforeend",'<div class="stf__outerShadow"></div>\n             <div class="stf__innerShadow"></div>\n             <div class="stf__hardShadow"></div>\n             <div class="stf__hardInnerShadow"></div>'),this.outerShadow=this.element.querySelector(".stf__outerShadow"),this.innerShadow=this.element.querySelector(".stf__innerShadow"),this.hardShadow=this.element.querySelector(".stf__hardShadow"),this.hardInnerShadow=this.element.querySelector(".stf__hardInnerShadow")}clearShadow(){super.clearShadow(),this.outerShadow.style.cssText="display: none",this.innerShadow.style.cssText="display: none",this.hardShadow.style.cssText="display: none",this.hardInnerShadow.style.cssText="display: none"}reload(){this.element.querySelector(".stf__outerShadow")||this.createShadows()}drawHardInnerShadow(){let a=this.getRect(),b=this.shadow.progress>100?200-this.shadow.progress:this.shadow.progress,c=(100-b)*(2.5*a.pageWidth)/100+20;c>a.pageWidth&&(c=a.pageWidth);let d=`
            display: block;
            z-index: ${(this.getSettings().startZIndex+5).toString(10)};
            width: ${c}px;
            height: ${a.height}px;
            background: linear-gradient(to right,
                rgba(0, 0, 0, ${this.shadow.opacity*b/100}) 5%,
                rgba(0, 0, 0, 0) 100%);
            left: ${a.left+a.width/2}px;
            transform-origin: 0 0;
        `;d+=0===this.getDirection()&&this.shadow.progress>100||1===this.getDirection()&&this.shadow.progress<=100?"transform: translate3d(0, 0, 0);":"transform: translate3d(0, 0, 0) rotateY(180deg);",this.hardInnerShadow.style.cssText=d}drawHardOuterShadow(){let a=this.getRect(),b=(100-(this.shadow.progress>100?200-this.shadow.progress:this.shadow.progress))*(2.5*a.pageWidth)/100+20;b>a.pageWidth&&(b=a.pageWidth);let c=`
            display: block;
            z-index: ${(this.getSettings().startZIndex+4).toString(10)};
            width: ${b}px;
            height: ${a.height}px;
            background: linear-gradient(to left, rgba(0, 0, 0, ${this.shadow.opacity}) 5%, rgba(0, 0, 0, 0) 100%);
            left: ${a.left+a.width/2}px;
            transform-origin: 0 0;
        `;c+=0===this.getDirection()&&this.shadow.progress>100||1===this.getDirection()&&this.shadow.progress<=100?"transform: translate3d(0, 0, 0) rotateY(180deg);":"transform: translate3d(0, 0, 0);",this.hardShadow.style.cssText=c}drawInnerShadow(){let a=this.getRect(),b=3*this.shadow.width/4,c=0===this.getDirection()?b:0,d=0===this.getDirection()?"to left":"to right",e=this.convertToGlobal(this.shadow.pos),g=this.shadow.angle+3*Math.PI/2,h=[this.pageRect.topLeft,this.pageRect.topRight,this.pageRect.bottomRight,this.pageRect.bottomLeft],i="polygon( ";for(let a of h){let b=1===this.getDirection()?{x:-a.x+this.shadow.pos.x,y:a.y-this.shadow.pos.y}:{x:a.x-this.shadow.pos.x,y:a.y-this.shadow.pos.y};i+=(b=f.GetRotatedPoint(b,{x:c,y:100},g)).x+"px "+b.y+"px, "}i=i.slice(0,-2)+")";let j=`
            display: block;
            z-index: ${(this.getSettings().startZIndex+10).toString(10)};
            width: ${b}px;
            height: ${2*a.height}px;
            background: linear-gradient(${d},
                rgba(0, 0, 0, ${this.shadow.opacity}) 5%,
                rgba(0, 0, 0, 0.05) 15%,
                rgba(0, 0, 0, ${this.shadow.opacity}) 35%,
                rgba(0, 0, 0, 0) 100%);
            transform-origin: ${c}px 100px;
            transform: translate3d(${e.x-c}px, ${e.y-100}px, 0) rotate(${g}rad);
            clip-path: ${i};
            -webkit-clip-path: ${i};
        `;this.innerShadow.style.cssText=j}drawOuterShadow(){let a=this.getRect(),b=this.convertToGlobal({x:this.shadow.pos.x,y:this.shadow.pos.y}),c=this.shadow.angle+3*Math.PI/2,d=1===this.getDirection()?this.shadow.width:0,e=0===this.getDirection()?"to right":"to left",g=[{x:0,y:0},{x:a.pageWidth,y:0},{x:a.pageWidth,y:a.height},{x:0,y:a.height}],h="polygon( ";for(let a of g)if(null!==a){let b=1===this.getDirection()?{x:-a.x+this.shadow.pos.x,y:a.y-this.shadow.pos.y}:{x:a.x-this.shadow.pos.x,y:a.y-this.shadow.pos.y};h+=(b=f.GetRotatedPoint(b,{x:d,y:100},c)).x+"px "+b.y+"px, "}h=h.slice(0,-2)+")";let i=`
            display: block;
            z-index: ${(this.getSettings().startZIndex+10).toString(10)};
            width: ${this.shadow.width}px;
            height: ${2*a.height}px;
            background: linear-gradient(${e}, rgba(0, 0, 0, ${this.shadow.opacity}), rgba(0, 0, 0, 0));
            transform-origin: ${d}px 100px;
            transform: translate3d(${b.x-d}px, ${b.y-100}px, 0) rotate(${c}rad);
            clip-path: ${h};
            -webkit-clip-path: ${h};
        `;this.outerShadow.style.cssText=i}drawLeftPage(){"portrait"!==this.orientation&&null!==this.leftPage&&(1===this.direction&&null!==this.flippingPage&&"hard"===this.flippingPage.getDrawingDensity()?(this.leftPage.getElement().style.zIndex=(this.getSettings().startZIndex+5).toString(10),this.leftPage.setHardDrawingAngle(180+this.flippingPage.getHardAngle()),this.leftPage.draw(this.flippingPage.getDrawingDensity())):this.leftPage.simpleDraw(0))}drawRightPage(){null!==this.rightPage&&(0===this.direction&&null!==this.flippingPage&&"hard"===this.flippingPage.getDrawingDensity()?(this.rightPage.getElement().style.zIndex=(this.getSettings().startZIndex+5).toString(10),this.rightPage.setHardDrawingAngle(180+this.flippingPage.getHardAngle()),this.rightPage.draw(this.flippingPage.getDrawingDensity())):this.rightPage.simpleDraw(1))}drawBottomPage(){if(null===this.bottomPage)return;let a=null!=this.flippingPage?this.flippingPage.getDrawingDensity():null;"portrait"===this.orientation&&1===this.direction||(this.bottomPage.getElement().style.zIndex=(this.getSettings().startZIndex+3).toString(10),this.bottomPage.draw(a))}drawFrame(){this.clear(),this.drawLeftPage(),this.drawRightPage(),this.drawBottomPage(),null!=this.flippingPage&&(this.flippingPage.getElement().style.zIndex=(this.getSettings().startZIndex+5).toString(10),this.flippingPage.draw()),null!=this.shadow&&null!==this.flippingPage&&("soft"===this.flippingPage.getDrawingDensity()?(this.drawOuterShadow(),this.drawInnerShadow()):(this.drawHardOuterShadow(),this.drawHardInnerShadow()))}clear(){for(let a of this.app.getPageCollection().getPages())a!==this.leftPage&&a!==this.rightPage&&a!==this.flippingPage&&a!==this.bottomPage&&(a.getElement().style.cssText="display: none"),a.getTemporaryCopy()!==this.flippingPage&&a.hideTemporaryCopy()}update(){super.update(),null!==this.rightPage&&this.rightPage.setOrientation(1),null!==this.leftPage&&this.leftPage.setOrientation(0)}}class q{constructor(){this._default={startPage:0,size:"fixed",width:0,height:0,minWidth:0,maxWidth:0,minHeight:0,maxHeight:0,drawShadow:!0,flippingTime:1e3,usePortrait:!0,startZIndex:0,autoSize:!0,maxShadowOpacity:1,showCover:!1,mobileScrollSupport:!0,swipeDistance:30,clickEventForward:!0,useMouseEvents:!0,showPageCorners:!0,disableFlipByClick:!1}}getSettings(a){let b=this._default;if(Object.assign(b,a),"stretch"!==b.size&&"fixed"!==b.size)throw Error('Invalid size type. Available only "fixed" and "stretch" value');if(b.width<=0||b.height<=0)throw Error("Invalid width or height");if(b.flippingTime<=0)throw Error("Invalid flipping time");return"stretch"===b.size?(b.minWidth<=0&&(b.minWidth=100),b.maxWidth<b.minWidth&&(b.maxWidth=2e3),b.minHeight<=0&&(b.minHeight=100),b.maxHeight<b.minHeight&&(b.maxHeight=2e3)):(b.minWidth=b.width,b.maxWidth=b.width,b.minHeight=b.height,b.maxHeight=b.height),b}}!function(a,b){void 0===b&&(b={});var c=b.insertAt;if(a&&"undefined"!=typeof document){var d=document.head||document.getElementsByTagName("head")[0],e=document.createElement("style");e.type="text/css","top"===c&&d.firstChild?d.insertBefore(e,d.firstChild):d.appendChild(e),e.styleSheet?e.styleSheet.cssText=a:e.appendChild(document.createTextNode(a))}}(".stf__parent {\n  position: relative;\n  display: block;\n  box-sizing: border-box;\n  transform: translateZ(0);\n\n  -ms-touch-action: pan-y;\n  touch-action: pan-y;\n}\n\n.sft__wrapper {\n  position: relative;\n  width: 100%;\n  box-sizing: border-box;\n}\n\n.stf__parent canvas {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  left: 0;\n  top: 0;\n}\n\n.stf__block {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  box-sizing: border-box;\n  perspective: 2000px;\n}\n\n.stf__item {\n  display: none;\n  position: absolute;\n  transform-style: preserve-3d;\n}\n\n.stf__outerShadow {\n  position: absolute;\n  left: 0;\n  top: 0;\n}\n\n.stf__innerShadow {\n  position: absolute;\n  left: 0;\n  top: 0;\n}\n\n.stf__hardShadow {\n  position: absolute;\n  left: 0;\n  top: 0;\n}\n\n.stf__hardInnerShadow {\n  position: absolute;\n  left: 0;\n  top: 0;\n}"),a.PageFlip=class extends class{constructor(){this.events=new Map}on(a,b){return this.events.has(a)?this.events.get(a).push(b):this.events.set(a,[b]),this}off(a){this.events.delete(a)}trigger(a,b,c=null){if(this.events.has(a))for(let d of this.events.get(a))d({data:c,object:b})}}{constructor(a,b){super(),this.isUserTouch=!1,this.isUserMove=!1,this.setting=null,this.pages=null,this.setting=(new q).getSettings(b),this.block=a}destroy(){this.ui.destroy(),this.block.remove()}update(){this.render.update(),this.pages.show()}loadFromImages(a){this.ui=new o(this.block,this,this.setting);let b=this.ui.getCanvas();this.render=new l(this,this.setting,b),this.flipController=new j(this.render,this),this.pages=new e(this,this.render,a),this.pages.load(),this.render.start(),this.pages.show(this.setting.startPage),setTimeout(()=>{this.ui.update(),this.trigger("init",this,{page:this.setting.startPage,mode:this.render.getOrientation()})},1)}loadFromHTML(a){this.ui=new n(this.block,this,this.setting,a),this.render=new p(this,this.setting,this.ui.getDistElement()),this.flipController=new j(this.render,this),this.pages=new h(this,this.render,this.ui.getDistElement(),a),this.pages.load(),this.render.start(),this.pages.show(this.setting.startPage),setTimeout(()=>{this.ui.update(),this.trigger("init",this,{page:this.setting.startPage,mode:this.render.getOrientation()})},1)}updateFromImages(a){let b=this.pages.getCurrentPageIndex();this.pages.destroy(),this.pages=new e(this,this.render,a),this.pages.load(),this.pages.show(b),this.trigger("update",this,{page:b,mode:this.render.getOrientation()})}updateFromHtml(a){let b=this.pages.getCurrentPageIndex();this.pages.destroy(),this.pages=new h(this,this.render,this.ui.getDistElement(),a),this.pages.load(),this.ui.updateItems(a),this.render.reload(),this.pages.show(b),this.trigger("update",this,{page:b,mode:this.render.getOrientation()})}clear(){this.pages.destroy(),this.ui.clear()}turnToPrevPage(){this.pages.showPrev()}turnToNextPage(){this.pages.showNext()}turnToPage(a){this.pages.show(a)}flipNext(a="top"){this.flipController.flipNext(a)}flipPrev(a="top"){this.flipController.flipPrev(a)}flip(a,b="top"){this.flipController.flipToPage(a,b)}updateState(a){this.trigger("changeState",this,a)}updatePageIndex(a){this.trigger("flip",this,a)}updateOrientation(a){this.ui.setOrientationStyle(a),this.update(),this.trigger("changeOrientation",this,a)}getPageCount(){return this.pages.getPageCount()}getCurrentPageIndex(){return this.pages.getCurrentPageIndex()}getPage(a){return this.pages.getPage(a)}getRender(){return this.render}getFlipController(){return this.flipController}getOrientation(){return this.render.getOrientation()}getBoundsRect(){return this.render.getRect()}getSettings(){return this.setting}getUI(){return this.ui}getState(){return this.flipController.getState()}getPageCollection(){return this.pages}startUserTouch(a){this.mousePosition=a,this.isUserTouch=!0,this.isUserMove=!1}userMove(a,b){this.isUserTouch||b||!this.setting.showPageCorners?this.isUserTouch&&f.GetDistanceBetweenTwoPoint(this.mousePosition,a)>5&&(this.isUserMove=!0,this.flipController.fold(a)):this.flipController.showCorner(a)}userStop(a,b=!1){this.isUserTouch&&(this.isUserTouch=!1,b||(this.isUserMove?this.flipController.stopMove():this.flipController.flip(a)))}},Object.defineProperty(a,"__esModule",{value:!0})}(c)},90285,a=>{"use strict";a.s([]);var b=a.i(72131),c=a.i(88824);let d=b.default.forwardRef((a,d)=>{let e=(0,b.useRef)(null),f=(0,b.useRef)([]),g=(0,b.useRef)(),[h,i]=(0,b.useState)([]);(0,b.useImperativeHandle)(d,()=>({pageFlip:()=>g.current}));let j=(0,b.useCallback)(()=>{g.current&&g.current.clear()},[]),k=(0,b.useCallback)(()=>{let a=g.current;a&&(a.off("flip"),a.off("changeOrientation"),a.off("changeState"),a.off("init"),a.off("update"))},[]);return(0,b.useEffect)(()=>{if(f.current=[],a.children){let c=b.default.Children.map(a.children,a=>b.default.cloneElement(a,{ref:a=>{a&&f.current.push(a)}}));a.renderOnlyPageLengthChange&&h.length===c.length||(c.length<h.length&&j(),i(c))}},[a.children]),(0,b.useEffect)(()=>{h.length>0&&f.current.length>0&&(k(),e.current&&!g.current&&(g.current=new c.PageFlip(e.current,a)),g.current.getFlipController()?g.current.updateFromHtml(f.current):g.current.loadFromHTML(f.current),(()=>{let b=g.current;b&&(a.onFlip&&b.on("flip",b=>a.onFlip(b)),a.onChangeOrientation&&b.on("changeOrientation",b=>a.onChangeOrientation(b)),a.onChangeState&&b.on("changeState",b=>a.onChangeState(b)),a.onInit&&b.on("init",b=>a.onInit(b)),a.onUpdate&&b.on("update",b=>a.onUpdate(b)))})())},[h]),b.default.createElement("div",{ref:e,className:a.className,style:a.style},h)});b.default.memo(d)}];

//# sourceMappingURL=node_modules_9806e0ce._.js.map